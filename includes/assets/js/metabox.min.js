window.nineCodesMetabox=window.nineCodesMetabox||{},function(e){"use strict";if(!_.isUndefined(nineCodesMetaboxData)){var t=nineCodesMetabox={metabox:{manager:{},section:{},control:{},nav:{}},template:{manager:{},section:{},control:{},nav:wp.template("ninecodes-metabox-nav")}},n={Model:Backbone.Model.extend({defaults:{name:"",type:"",sections:{},controls:{}}})},i={Model:Backbone.Model.extend({defaults:{name:"",type:"",label:"",description:"",icon:"",manager:"",active:"",selected:!1}}),Collection:Backbone.Collection.extend({})},o={Model:Backbone.Model.extend({defaults:{name:"",type:"",label:"",description:"",icon:"",value:"",choices:{},attr:"",active:"",manager:"",section:"",setting:""}})},a={View:{}};t.metabox.registerManager=function(e,t){"default"!==e&&(this.manager[e]=this.manager.default.extend(t))},t.metabox.getManager=function(e){return this.managerExists(e)?this.manager[e]:this.manager.default},t.metabox.unregisterManager=function(e){"default"!==e&&this.managerExists(e)&&delete this.manager[e]},t.metabox.managerExists=function(e){return this.manager.hasOwnProperty(e)},t.metabox.registerSection=function(e,t){"default"!==e&&(this.section[e]=this.section.default.extend(t))},t.metabox.getSection=function(e){return this.sectionExists(e)?this.section[e]:this.section.default},t.metabox.unregisterSection=function(e){"default"!==e&&this.sectionExists(e)&&delete this.section[e]},t.metabox.sectionExists=function(e){return this.section.hasOwnProperty(e)},t.metabox.registerControl=function(e,t){"default"!==e&&(this.control[e]=this.control.default.extend(t))},t.metabox.getControl=function(e){return this.controlExists(e)?this.control[e]:this.control.default},t.metabox.unregisterControl=function(e){"default"!==e&&this.controlExists(e)&&delete this.control[e]},t.metabox.controlExists=function(e){return this.control.hasOwnProperty(e)},t.template.registerManager=function(e){this.manager[e]=wp.template("ninecodes-metabox-manager-"+e)},t.template.getManager=function(e){return!!this.managerExists(e)&&this.manager[e]},t.template.unregisterManager=function(e){this.managerExists(e)&&delete this.manager[e]},t.template.managerExists=function(e){return this.manager.hasOwnProperty(e)},t.template.registerSection=function(e){this.section[e]=wp.template("ninecodes-metabox-section-"+e)},t.template.getSection=function(e){return!!this.sectionExists(e)&&this.section[e]},t.template.unregisterSection=function(e){this.sectionExists(e)&&delete this.section[e]},t.template.sectionExists=function(e){return this.section.hasOwnProperty(e)},t.template.registerControl=function(e){this.control[e]=wp.template("ninecodes-metabox-control-"+e)},t.template.getControl=function(e){return!!this.controlExists(e)&&this.control[e]},t.template.unregisterControl=function(e){this.controlExists(e)&&delete this.control[e]},t.template.controlExists=function(e){return this.control.hasOwnProperty(e)},t.render=function(){_.each(nineCodesMetaboxData.managers,function(e){var i=new n.Model(e),o=new(t.metabox.getManager(e.type))({model:i}),a=document.getElementById("ninecodes-metabox-ui-"+i.get("name"));a.className+=" ninecodes-metabox-ui",a.querySelector(".inside").appendChild(o.render().el),o.subViewRender(),o.ready()})},a.View=Backbone.View.extend({template:t.template.nav,tagName:"li",events:{"click a":"onSelect"},attributes:function(){return{"aria-selected":this.model.get("selected")}},initialize:function(){this.model.on("change",this.render,this),this.model.on("change",this.onChange,this)},render:function(){return this.model.get("active")&&(this.el.innerHTML=this.template(this.model.toJSON())),this},onChange:function(){this.el.setAttribute("aria-selected",this.model.get("selected"))},onSelect:function(e){e.preventDefault(),_.each(this.model.collection.models,function(e){e.set("selected",!1)},this),this.model.set("selected",!0)}}),t.metabox.manager.default=Backbone.View.extend({tagName:"div",attributes:function(){return{id:"ninecodes-metabox-manager-"+this.model.get("name"),class:"ninecodes-metabox-manager ninecodes-metabox-manager-"+this.model.get("type")}},initialize:function(){var e=this.model.get("type");t.template.managerExists(e)||t.template.registerManager(e),this.template=t.template.getManager(e)},render:function(){return this.el.innerHTML=this.template(this.model.toJSON()),this},subViewRender:function(){var e=new i.Collection;return _.each(this.model.get("sections"),function(t){e.add(new i.Model(t))}),e.forEach(function(e,n){var i=new a.View({model:e}),o=new(t.metabox.getSection(e.attributes.type))({model:e});document.querySelector("#ninecodes-metabox-ui-"+e.get("manager")+" .ninecodes-metabox-nav").appendChild(i.render().el),document.querySelector("#ninecodes-metabox-ui-"+e.get("manager")+" .ninecodes-metabox-content").appendChild(o.render().el),o.ready(),e.set("selected",0===n)},this),_.each(this.model.get("controls"),function(e){var n=new o.Model(e),i=new(t.metabox.getControl(e.type))({model:n});document.getElementById("ninecodes-metabox-"+n.get("manager")+"-section-"+n.get("section")).appendChild(i.render().el),i.ready()}),this},ready:function(){}}),t.metabox.section.default=Backbone.View.extend({tagName:"div",model:new i.Model,attributes:function(){return{id:"ninecodes-metabox-"+this.model.get("manager")+"-section-"+this.model.get("name"),class:"ninecodes-metabox-section ninecodes-metabox-section-"+this.model.get("type"),"aria-hidden":!this.model.get("selected")}},initialize:function(){this.model.on("change",this.onChange,this);var e=this.model.get("type");t.template.sectionExists(e)||t.template.registerSection(e),this.template=t.template.getSection(e)},render:function(){return this.model.get("active")&&(this.el.innerHTML=this.template(this.model.toJSON())),this},onChange:function(){this.el.setAttribute("aria-hidden",!this.model.get("selected"))},ready:function(){}}),t.metabox.control.default=Backbone.View.extend({tagName:"div",attributes:function(){return{id:"ninecodes-metabox-control-"+this.model.get("name"),class:"ninecodes-metabox-control ninecodes-metabox-control-"+this.model.get("type")}},initialize:function(){var e=this.model.get("type");t.template.controlExists(e)||t.template.registerControl(e),this.template=t.template.getControl(e),_.bindAll(this,"render"),this.model.bind("change",this.render)},render:function(){return this.model.get("active")&&(this.el.innerHTML=this.template(this.model.toJSON())),this},ready:function(){}}),t.metabox.registerControl("color",{ready:function(){var t=this.model.attributes.options;e(this.$el).find(".ninecodes-metabox-color-picker").wpColorPicker(t)}}),t.metabox.registerControl("palette",{events:{"change input":"onSelect"},onSelect:function(){var e=document.querySelector("#"+this.el.id+" input:checked").getAttribute("value"),t=this.model.get("choices");_.each(t,function(t,n){t.selected=n===e}),this.model.set("choices",t).trigger("change",this.model)}}),t.metabox.registerControl("image",{events:{"click .ninecodes-metabox-add-media":"showModal","click .ninecodes-metabox-change-media":"showModal","click .ninecodes-metabox-remove-media":"removeMedia"},showModal:function(){_.isUndefined(this.wpMediaModal)?(this.wpMediaModal=wp.media({frame:"select",multiple:!1,editing:!0,title:this.model.get("l10n").choose,library:{type:"image"},button:{text:this.model.get("l10n").set}}),this.wpMediaModal.on("select",function(){var e=this.wpMediaModal.state().get("selection").first().toJSON(),t=this.model.attributes.size;this.model.set({src:e.sizes[t]?e.sizes[t].url:e.url,alt:e.alt,value:e.id})},this),this.wpMediaModal.open()):this.wpMediaModal.open()},removeMedia:function(){this.model.set({src:"",alt:"",value:""})}})}}(jQuery);
//# sourceMappingURL=metabox.min.js.map